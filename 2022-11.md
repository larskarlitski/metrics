# Image Builder Business Metrics

_November 2022_

    import ibmetrics
    import datetime
    import pandas

    ga_date = datetime.datetime(2022, 5, 4)
    end_date = datetime.datetime(2022, 12, 1, 0, 0)

    builds, subscriptions = ibmetrics.load(
        "./data/dump-2022-12-05.log",
        "./data/16_image-builder-consumers.tsv",
        "./data/userinfo.json",
        "./data/userfilter.txt",
        ga_date, end_date
    )
    total_builds = 148102

Since we launched Image Builder on May 9, the service has built
**{total_builds:,d}** images. While that number sounds impressive, it is a vanity
metric—it says more about our ability to operate a service than about the value
we provide to customers.

This report instead focuses on **how much value** Image Builder is providing to
**how many customers**. It also breaks down which **footprints** customers
build images for.

## Value

    n_instances = len(subscriptions)

    # this ignores "NaT" (not a time/type) values
    deltas = subscriptions["lastcheckin"] - subscriptions["created"]
    total_runtime = deltas.sum().days

    # count all machines that checked in on the last day as still running
    cutoff = end_date - datetime.timedelta(days=1)
    n_active = (subscriptions["lastcheckin"] > cutoff).sum()

Customers get value from running their workloads on RHEL machines. Image
Builder contributes to this value if it built the image that those instances
booted from. At the beginning of September, Image Builder started to embed a
fact into the image that Red Hat Subscription Manager (RHSM) reports when
registering. Since then, **{n_instances:,d} RHEL instances** based on images
built in the Image Builder service have registered[^1] and run for
**{total_runtime:,d} days** combined. (Ideally, we’d measure what customers
pay, but this data is difficult to source.)

    ibmetrics.plot.monthly_active_time(subscriptions)

At the end of November, **{n_active}** RHEL instances were running that are
based on images from Image Builder.

## Customers

    n_orgs = builds["org_id"].nunique()

Customers experience value from building and using images. **{n_orgs}**
organizations[^2] have built at least one image since the service launched.
Many of those have only used it once, which could either mean that  they
discard it after trying it out, or that they don’t need new images for long
periods of time. Again, there’s still too little usage of the service to make
strong claims about trends.

    ibmetrics.plot.monthly_orgs(builds)

## Footprints

    n_images = len(builds)

Customers have built **{n_images}** images since launch, a majority of them for
private clouds. Only **about a fifth** of those images are for public clouds,
even though this is Image Builder’s focus and value proposition.

    ibmetrics.plot.builds_per_footprint(builds)

## Sources

- Image Builder production database
- [RHSM data](https://gitlab.corp.redhat.com/it-pnt/entitlement-scorecard/-/tree/master/target/prod/2022-11-01)
- [Source code](https://github.com/osbuild/metrics) for the above analyses

[^1]: This includes instances that have only registered once, i.e. ran for less
  than four hours.
[^2]: All numbers refer to *organizations*, which are accounts for a single
  customer, not to individual users.

